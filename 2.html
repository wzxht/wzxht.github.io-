<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基尔霍夫电压定律交互演示</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 20px;
            max-width: 900px;
            width: 100%;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }
        .description {
            text-align: center;
            margin-bottom: 20px;
            color: #7f8c8d;
        }
        .circuit-container {
            position: relative;
            margin: 20px auto;
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
            overflow: hidden;
        }
        #circuitCanvas {
            width: 100%;
            height: 100%;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 15px;
            margin: 20px 0;
        }
        .control-group {
            flex: 1;
            min-width: 200px;
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
        }
        .control-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .slider-container {
            margin: 10px 0;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        input[type="range"] {
            width: 100%;
        }
        .values-display {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fc;
            border-radius: 8px;
        }
        .values-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #2980b9;
        }
        .value-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
        }
        .kvl-equation {
            margin-top: 15px;
            padding: 12px;
            background-color: #fff4e6;
            border-radius: 8px;
            font-family: monospace;
            text-align: center;
            font-size: 18px;
        }
        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            line-height: 1.6;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>基尔霍夫电压定律交互演示</h1>
        <p class="description">调整电阻值，观察电路中电流和电压的变化，验证基尔霍夫电压定律</p>
        
        <div class="circuit-container">
            <canvas id="circuitCanvas"></canvas>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <div class="control-title">电源电压</div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>电压值</span>
                        <span id="voltageValue">12 V</span>
                    </div>
                    <input type="range" id="voltageSlider" min="5" max="24" value="12" step="1">
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-title">电阻调节</div>
                <div class="slider-container">
                    <div class="slider-label">
                        <span>电阻 1</span>
                        <span id="resistor1Value">100 Ω</span>
                    </div>
                    <input type="range" id="resistor1Slider" min="50" max="500" value="100" step="10">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>电阻 2</span>
                        <span id="resistor2Value">200 Ω</span>
                    </div>
                    <input type="range" id="resistor2Slider" min="50" max="500" value="200" step="10">
                </div>
                
                <div class="slider-container">
                    <div class="slider-label">
                        <span>电阻 3</span>
                        <span id="resistor3Value">300 Ω</span>
                    </div>
                    <input type="range" id="resistor3Slider" min="50" max="500" value="300" step="10">
                </div>
            </div>
        </div>
        
        <div class="values-display">
            <div class="values-title">电路测量值</div>
            <div class="value-item">
                <span>总电流 (I):</span>
                <span id="currentValue">0.02 A</span>
            </div>
            <div class="value-item">
                <span>电阻 1 电压降:</span>
                <span id="voltageDrop1">2.00 V</span>
            </div>
            <div class="value-item">
                <span>电阻 2 电压降:</span>
                <span id="voltageDrop2">4.00 V</span>
            </div>
            <div class="value-item">
                <span>电阻 3 电压降:</span>
                <span id="voltageDrop3">6.00 V</span>
            </div>
            <div class="value-item">
                <span>总电压降 ∑(V<sub>R</sub>):</span>
                <span id="totalVoltageDrop">12.00 V</span>
            </div>
        </div>
        
        <div class="kvl-equation">
            基尔霍夫电压定律: V<sub>电源</sub> = V<sub>R1</sub> + V<sub>R2</sub> + V<sub>R3</sub> ⇒ 
            <span id="kvlEquation">12.00 V = 2.00 V + 4.00 V + 6.00 V</span>
        </div>
        
        <div class="explanation">
            <p><strong>基尔霍夫电压定律 (KVL)</strong> 指出：在任何一个闭合回路中，所有电压的代数和等于零[1,4](@ref)。在这个电路中，电源提供的电压等于所有电阻上的电压降之和。</p>
            <p>尝试调整电源电压或电阻值，观察电流和各个电压降的变化。注意无论值如何变化，总电压降始终等于电源电压，这验证了基尔霍夫电压定律。</p>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button id="resetButton">重置电路</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('circuitCanvas');
            const ctx = canvas.getContext('2d');
            
            // 调整Canvas大小以匹配容器
            function resizeCanvas() {
                canvas.width = canvas.parentElement.clientWidth;
                canvas.height = canvas.parentElement.clientHeight;
                drawCircuit();
            }
            
            // 初始化变量
            let voltage = 12; // 电压(V)
            let resistor1 = 100; // 电阻1(Ω)
            let resistor2 = 200; // 电阻2(Ω)
            let resistor3 = 300; // 电阻3(Ω)
            let totalResistance = resistor1 + resistor2 + resistor3;
            let current = voltage / totalResistance; // 电流(A)
            
            // 计算电压降
            const voltageDrop1 = current * resistor1;
            const voltageDrop2 = current * resistor2;
            const voltageDrop3 = current * resistor3;
            
            // 元件位置和尺寸
            const componentPositions = {
                battery: { x: 0, y: 0, width: 0, height: 0 },
                resistor1: { x: 0, y: 0, width: 0, height: 0 },
                resistor2: { x: 0, y: 0, width: 0, height: 0 },
                resistor3: { x: 0, y: 0, width: 0, height: 0 }
            };
            
            // 电流动画
            let electronPositions = [];
            
            // 绘制电路
            function drawCircuit() {
                const width = canvas.width;
                const height = canvas.height;
                
                // 清除画布
                ctx.clearRect(0, 0, width, height);
                
                // 计算元件位置
                const margin = 40;
                const availableWidth = width - 2 * margin;
                const availableHeight = height - 2 * margin;
                
                // 电路路径点
                const pathPoints = [
                    { x: margin + availableWidth * 0.2, y: margin + availableHeight * 0.5 }, // 起点/电池左侧
                    { x: margin + availableWidth * 0.2, y: margin + availableHeight * 0.2 }, // 上转角
                    { x: margin + availableWidth * 0.8, y: margin + availableHeight * 0.2 }, // 上水平线
                    { x: margin + availableWidth * 0.8, y: margin + availableHeight * 0.5 }, // 电阻3右侧
                    { x: margin + availableWidth * 0.8, y: margin + availableHeight * 0.8 }, // 下转角
                    { x: margin + availableWidth * 0.2, y: margin + availableHeight * 0.8 }, // 下水平线
                    { x: margin + availableWidth * 0.2, y: margin + availableHeight * 0.5 }  // 回到电池
                ];
                
                // 绘制导线
                ctx.beginPath();
                ctx.moveTo(pathPoints[0].x, pathPoints[0].y);
                for (let i = 1; i < pathPoints.length; i++) {
                    ctx.lineTo(pathPoints[i].x, pathPoints[i].y);
                }
                ctx.closePath();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // 绘制电池
                const batteryWidth = 40;
                const batteryHeight = 60;
                const batteryX = pathPoints[0].x - batteryWidth/2;
                const batteryY = pathPoints[0].y - batteryHeight/2;
                
                ctx.fillStyle = '#FFCC00';
                ctx.fillRect(batteryX, batteryY, batteryWidth, batteryHeight);
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.strokeRect(batteryX, batteryY, batteryWidth, batteryHeight);
                
                // 电池正负极标记
                ctx.fillStyle = '#333';
                ctx.fillRect(batteryX + batteryWidth/2 - 5, batteryY - 10, 10, 10); // 正极
                ctx.fillRect(batteryX + batteryWidth/2 - 5, batteryY + batteryHeight, 10, 10); // 负极
                
                // 保存电池位置
                componentPositions.battery = { 
                    x: batteryX, 
                    y: batteryY, 
                    width: batteryWidth, 
                    height: batteryHeight 
                };
                
                // 绘制电阻1
                const resistorWidth = 50;
                const resistorHeight = 20;
                const resistor1X = pathPoints[1].x + (pathPoints[2].x - pathPoints[1].x) * 0.3 - resistorWidth/2;
                const resistor1Y = pathPoints[1].y - resistorHeight/2;
                
                drawResistor(resistor1X, resistor1Y, resistorWidth, resistorHeight, '#E74C3C');
                componentPositions.resistor1 = { 
                    x: resistor1X, 
                    y: resistor1Y, 
                    width: resistorWidth, 
                    height: resistorHeight 
                };
                
                // 绘制电阻2
                const resistor2X = pathPoints[2].x - resistorWidth/2;
                const resistor2Y = pathPoints[2].y + (pathPoints[3].y - pathPoints[2].y) * 0.3 - resistorHeight/2;
                
                drawResistor(resistor2X, resistor2Y, resistorWidth, resistorHeight, '#3498DB');
                componentPositions.resistor2 = { 
                    x: resistor2X, 
                    y: resistor2Y, 
                    width: resistorWidth, 
                    height: resistorHeight 
                };
                
                // 绘制电阻3
                const resistor3X = pathPoints[4].x + (pathPoints[5].x - pathPoints[4].x) * 0.3 - resistorWidth/2;
                const resistor3Y = pathPoints[4].y - resistorHeight/2;
                
                drawResistor(resistor3X, resistor3Y, resistorWidth, resistorHeight, '#2ECC71');
                componentPositions.resistor3 = { 
                    x: resistor3X, 
                    y: resistor3Y, 
                    width: resistorWidth, 
                    height: resistorHeight 
                };
                
                // 绘制电流（移动的电子）
                drawCurrent();
            }
            
            // 绘制电阻
            function drawResistor(x, y, width, height, color) {
                ctx.fillStyle = color;
                ctx.fillRect(x, y, width, height);
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.strokeRect(x, y, width, height);
                
                // 绘制电阻锯齿线
                ctx.beginPath();
                ctx.moveTo(x + 5, y + height/2);
                for (let i = 1; i <= 4; i++) {
                    const xPos = x + 5 + (i * (width - 10) / 4);
                    const yPos = (i % 2 === 0) ? y + height/2 - 5 : y + height/2 + 5;
                    ctx.lineTo(xPos, yPos);
                }
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            // 绘制电流动画
            function drawCurrent() {
                const width = canvas.width;
                const height = canvas.height;
                const margin = 40;
                const availableWidth = width - 2 * margin;
                const availableHeight = height - 2 * margin;
                
                // 电路路径点
                const pathPoints = [
                    { x: margin + availableWidth * 0.2, y: margin + availableHeight * 0.5 }, // 起点/电池左侧
                    { x: margin + availableWidth * 0.2, y: margin + availableHeight * 0.2 }, // 上转角
                    { x: margin + availableWidth * 0.8, y: margin + availableHeight * 0.2 }, // 上水平线
                    { x: margin + availableWidth * 0.8, y: margin + availableHeight * 0.5 }, // 电阻3右侧
                    { x: margin + availableWidth * 0.8, y: margin + availableHeight * 0.8 }, // 下转角
                    { x: margin + availableWidth * 0.2, y: margin + availableHeight * 0.8 }, // 下水平线
                    { x: margin + availableWidth * 0.2, y: margin + availableHeight * 0.5 }  // 回到电池
                ];
                
                // 初始化电子位置
                if (electronPositions.length === 0) {
                    for (let i = 0; i < 15; i++) {
                        electronPositions.push({
                            position: i * 0.05, // 在路径上的位置 (0-1)
                            speed: 0.005 + Math.random() * 0.003 // 随机速度
                        });
                    }
                }
                
                // 更新和绘制电子
                for (let i = 0; i < electronPositions.length; i++) {
                    const electron = electronPositions[i];
                    
                    // 计算电子在路径上的坐标
                    let pathPos = electron.position;
                    let segmentIndex = 0;
                    let segmentPos = 0;
                    
                    // 确定电子在哪一段路径上
                    const pathSegments = [
                        { from: 0, to: 1, length: Math.abs(pathPoints[1].y - pathPoints[0].y) }, // 电池到上转角
                        { from: 1, to: 2, length: Math.abs(pathPoints[2].x - pathPoints[1].x) }, // 上水平线
                        { from: 2, to: 3, length: Math.abs(pathPoints[3].y - pathPoints[2].y) }, // 到电阻3右侧
                        { from: 3, to: 4, length: Math.abs(pathPoints[4].y - pathPoints[3].y) }, // 到下转角
                        { from: 4, to: 5, length: Math.abs(pathPoints[5].x - pathPoints[4].x) }, // 下水平线
                        { from: 5, to: 6, length: Math.abs(pathPoints[6].y - pathPoints[5].y) }  // 回到电池
                    ];
                    
                    let totalLength = pathSegments.reduce((sum, seg) => sum + seg.length, 0);
                    let currentLength = 0;
                    
                    for (let j = 0; j < pathSegments.length; j++) {
                        const seg = pathSegments[j];
                        const segFraction = seg.length / totalLength;
                        
                        if (pathPos <= currentLength + segFraction) {
                            segmentIndex = j;
                            segmentPos = (pathPos - currentLength) / segFraction;
                            break;
                        }
                        currentLength += segFraction;
                    }
                    
                    const seg = pathSegments[segmentIndex];
                    const fromPoint = pathPoints[seg.from];
                    const toPoint = pathPoints[seg.to];
                    
                    const electronX = fromPoint.x + (toPoint.x - fromPoint.x) * segmentPos;
                    const electronY = fromPoint.y + (toPoint.y - fromPoint.y) * segmentPos;
                    
                    // 绘制电子
                    ctx.beginPath();
                    ctx.arc(electronX, electronY, 4, 0, Math.PI * 2);
                    ctx.fillStyle = '#3498DB';
                    ctx.fill();
                    ctx.strokeStyle = '#2980B9';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                    
                    // 更新电子位置
                    electron.position += electron.speed * (current / 0.02); // 速度与电流成正比
                    if (electron.position > 1) electron.position = 0;
                }
            }
            
            // 更新电路计算
            function updateCalculations() {
                totalResistance = resistor1 + resistor2 + resistor3;
                current = voltage / totalResistance;
                
                const vDrop1 = current * resistor1;
                const vDrop2 = current * resistor2;
                const vDrop3 = current * resistor3;
                const totalVDrop = vDrop1 + vDrop2 + vDrop3;
                
                // 更新显示值
                document.getElementById('currentValue').textContent = current.toFixed(3) + ' A';
                document.getElementById('voltageDrop1').textContent = vDrop1.toFixed(2) + ' V';
                document.getElementById('voltageDrop2').textContent = vDrop2.toFixed(2) + ' V';
                document.getElementById('voltageDrop3').textContent = vDrop3.toFixed(2) + ' V';
                document.getElementById('totalVoltageDrop').textContent = totalVDrop.toFixed(2) + ' V';
                
                // 更新KVL方程
                document.getElementById('kvlEquation').textContent = 
                    `${voltage.toFixed(2)} V = ${vDrop1.toFixed(2)} V + ${vDrop2.toFixed(2)} V + ${vDrop3.toFixed(2)} V`;
            }
            
            // 初始化事件监听器
            function initEventListeners() {
                // 电压滑块
                const voltageSlider = document.getElementById('voltageSlider');
                const voltageValue = document.getElementById('voltageValue');
                
                voltageSlider.addEventListener('input', function() {
                    voltage = parseInt(this.value);
                    voltageValue.textContent = voltage + ' V';
                    updateCalculations();
                });
                
                // 电阻滑块
                const resistor1Slider = document.getElementById('resistor1Slider');
                const resistor1Value = document.getElementById('resistor1Value');
                
                resistor1Slider.addEventListener('input', function() {
                    resistor1 = parseInt(this.value);
                    resistor1Value.textContent = resistor1 + ' Ω';
                    updateCalculations();
                });
                
                const resistor2Slider = document.getElementById('resistor2Slider');
                const resistor2Value = document.getElementById('resistor2Value');
                
                resistor2Slider.addEventListener('input', function() {
                    resistor2 = parseInt(this.value);
                    resistor2Value.textContent = resistor2 + ' Ω';
                    updateCalculations();
                });
                
                const resistor3Slider = document.getElementById('resistor3Slider');
                const resistor3Value = document.getElementById('resistor3Value');
                
                resistor3Slider.addEventListener('input', function() {
                    resistor3 = parseInt(this.value);
                    resistor3Value.textContent = resistor3 + ' Ω';
                    updateCalculations();
                });
                
                // 重置按钮
                document.getElementById('resetButton').addEventListener('click', function() {
                    voltage = 12;
                    resistor1 = 100;
                    resistor2 = 200;
                    resistor3 = 300;
                    
                    voltageSlider.value = voltage;
                    voltageValue.textContent = voltage + ' V';
                    
                    resistor1Slider.value = resistor1;
                    resistor1Value.textContent = resistor1 + ' Ω';
                    
                    resistor2Slider.value = resistor2;
                    resistor2Value.textContent = resistor2 + ' Ω';
                    
                    resistor3Slider.value = resistor3;
                    resistor3Value.textContent = resistor3 + ' Ω';
                    
                    updateCalculations();
                });
                
                // 窗口大小调整
                window.addEventListener('resize', function() {
                    resizeCanvas();
                });
            }
            
            // 动画循环
            function animate() {
                drawCircuit();
                requestAnimationFrame(animate);
            }
            
            // 初始化
            resizeCanvas();
            initEventListeners();
            updateCalculations();
            animate();
        });
    </script>
</body>
</html>